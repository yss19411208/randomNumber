<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランダム数字生成</title>
  <style>
    body {
      font-family: "Segoe UI", "Hiragino Kaku Gothic ProN", sans-serif;
      background: #f0f4f8;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 50px;
    }
    .container {
      background: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      width: 420px;
    }
    h3 {
      margin-bottom: 20px;
      color: #333;
    }
    label {
      display: block;
      margin: 10px 0;
      font-size: 14px;
      text-align: left;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      margin-top: 15px;
      padding: 10px 15px;
      background: #4CAF50;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #45a049;
    }
    #resetBtn {
      background: #888;
      margin-top: 10px;
    }
    #resetBtn:hover {
      background: #777;
    }
    #result {
      margin-top: 20px;
      padding: 10px;
      background: #f9fafb;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      color: #333;
      min-height: 24px;
      word-break: break-all;
    }
    .number-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 10px;
      text-align: center;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .num-btn {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 6px 0;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
      user-select: none;
    }
    .num-btn.selected {
      background: #007bff;
      color: white;
      border-color: #0056b3;
    }
    .num-btn:hover {
      background: #e6f0ff;
    }
    .toggle-header {
      cursor: pointer;
      font-weight: bold;
      color: #333;
      background: #eef2f6;
      padding: 8px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    .toggle-arrow {
      transition: transform 0.3s;
    }
    .collapsed .toggle-arrow {
      transform: rotate(-90deg);
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h3>ランダム数字生成</h3>
    <label>生成個数: <input type="number" id="n" value="5"></label>
    <label>範囲 (1 ~ n): <input type="number" id="k" value="29" onchange="updateNumberButtons()"></label>

<!-- アコーディオン部分 -->
<div id="absentSection" class="collapsed">
  <div class="toggle-header" onclick="toggleAbsentSection()">
    欠席者を選択
    <span class="toggle-arrow">▼</span>
  </div>
  <div id="absentContent" class="hidden">
    <div class="number-grid" id="absentGrid"></div>
    <div style="text-align:right;">
      <button id="resetBtn" onclick="resetAbsent()">リセット</button>
    </div>
  </div>
</div>

<label style="margin-top:20px;">生成モード:
  <select id="mode" onchange="modeChanged()">
    <option value="continuous">連続生成</option>
    <option value="single">単発生成</option>
  </select>
</label>

<button onclick="generate()">生成</button>
<p id="result">結果がここに表示されます</p>

  </div>

  <script>
    let singleGenerated = new Set();
    let history = [];
    let absentSet = new Set();
    let isOpen = false;

    function shuffle(array){
      for(let i = array.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function modeChanged() {
      singleGenerated.clear();
      history = [];
      updateResultDisplay();
    }

    function updateResultDisplay() {
      const display = history.length > 0 ? history.join(", ") : "結果がここに表示されます";
      document.getElementById("result").innerText = display;
    }

    function updateNumberButtons() {
      const k = parseInt(document.getElementById("k").value);
      const grid = document.getElementById("absentGrid");
      grid.innerHTML = "";
      absentSet.clear();

      for (let i = 1; i <= k; i++) {
        const btn = document.createElement("div");
        btn.className = "num-btn";
        btn.textContent = i;
        btn.onclick = () => toggleAbsent(i, btn);
        grid.appendChild(btn);
      }
    }

    function toggleAbsent(i, btn) {
      if (absentSet.has(i)) {
        absentSet.delete(i);
        btn.classList.remove("selected");
      } else {
        absentSet.add(i);
        btn.classList.add("selected");
      }
    }

    function resetAbsent() {
      absentSet.clear();
      document.querySelectorAll(".num-btn").forEach(btn => btn.classList.remove("selected"));
    }

    function generate() {
      const n = parseInt(document.getElementById("n").value);
      const k = parseInt(document.getElementById("k").value);
      const mode = document.getElementById("mode").value;

      const available = [];
      for (let i = 1; i <= k; i++) {
        if (!absentSet.has(i)) available.push(i);
      }

      if (available.length === 0) {
        singleGenerated.clear();
        history = [];
        updateResultDisplay();
        return;
      }

      if (mode === "continuous") {
        const shuffled = shuffle([...available]);
        history = shuffled.slice(0, Math.min(n, shuffled.length));
      } else {
        let remaining = available.filter(x => !singleGenerated.has(x));
        if (remaining.length === 0) {
          singleGenerated.clear();
          history = [];
          remaining = [...available];
        }
        const idx = Math.floor(Math.random() * remaining.length);
        const chosen = remaining[idx];
        singleGenerated.add(chosen);
        history.push(chosen);
      }

      updateResultDisplay();
    }

    function toggleAbsentSection() {
      const section = document.getElementById("absentSection");
      const content = document.getElementById("absentContent");
      const arrow = section.querySelector(".toggle-arrow");
      content.classList.toggle("hidden");
      section.classList.toggle("collapsed");
    }

    updateNumberButtons();
  </script>

</body>
</html>
